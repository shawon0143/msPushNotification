# schemaValidator

Validate an object on the basis af an schema.

## Installation

```bash
$ npm install git+https://npm:npmkdfu29ejij@tools.comvalue.com/bitbucket/scm/nod/validateschema.git
```

## Descriptions

schemaValidator validates an object and returns errors and warnings depending on the warning mode.


## Constructor

    new SchemaValidator(warningMode, log);

## Usage example

    const SchemaValidator = require('schemaValidator'),
    schemaValidator = new SchemaValidator('debug');

    const schemaAddress = {
        street : { type: 'string', require: true, min: 5, max: 100 },
        zip: { type: 'string', require: true, min: 4, max: 8 },
        city : { type: 'string', require: true, min: 5, max: 100 }
    };

    const schemaPerson = {
        lastName: { type: 'string', require: true, min: 2, max: 20 },
        firstName: { type: 'string', require: true, min: 2, max: 50, regEx: '^[A-Z]+[a-zA-Z]*$' },
        nickNames: { type: 'array', arrayType: 'string', min: 1, max: 3, require: false, valueMin: 2, valueMax: 50, valueRegEx: '^[A-Z]+[a-zA-Z]*$' },
        age: { type: 'number', require: false, min: 3, max: 50 },
        address: { type: 'schema', require: true, schema: 'address' }
    };

    schemaValidator.addSchema('person', schemaPerson);
    schemaValidator.addSchema('address', schemaAddress);

    let errors = [],
        warnings = [];

    var result = schemaValidator.validateObject('person', { firstName: 'Max', lastName: 'Muster', nickNames: ['Maxi'], address: { street: 'MaxStrasse', zip: '12345', city: 'Teststadt' } }, errors, warnings);
    console.log(result);
    console.log(errors);
    console.log(warnings);

    //with conditions:

    const schemaChatMessageText = {
        text: { type: 'string', require: true}
    }

    const schemaChatMessageHtml = {
        html: { type: 'string', require: true}
    }

    const schemaChatMessage = {
        errorCode: { type: 'integer', require: true },
        msgtype: { type: 'integer', require: true },
        addedHtml: { type: 'integer', require: false },
        includeSchema: 'chatMessageText on errorCode=0 and msgtype>0, chatMessageHtml on errorCode=0 and msgtype=2 and addedHtml=1'
    }

    errors = [];
    warnings = [];

    result = schemaValidator.validateObject('chatMessage', { errorCode: 0, msgtype: 2, text: "hallo", html: "huhu", addedHtml: 1 }, errors, warnings);

    console.log(result);
    console.log(errors);
    console.log(warnings);

## WarningModes

    strict, debug, ignore

schemaValidator.validateObject returns always false on errors. If no errors but warnings are present the return value depends on warningMode:

strict: warnings are returned as errors, validateObject returns false on warnings

debug: warnings and errors are seperated, validateObject returns true on warnings

ignore: warnings are ignored and only errors are returned, validateObject returns true on warnings

## Defining a schema

    schemaName: {
        type: type,
        [require: true|false = false,]
        [min: value,]
        [max: value,]
        [valueMin: value,]
        [valueMax: value,]
        [default: value,]
        [regEx: value,]
        [valueRegEx: value,]
        [arrayType: type,]
        [schema: value]
    }

    [] = optional

## Additional info to a schema

    includeSchema: value //schema name like 'chatMessageText' or multiple schemas, comma seperated

#### Types

one of the following values:

    string, integer, number, date, boolean, email, fqnd, json, array, schema, file, binary, ignore

if type is json, every additional jsonobject can be delivered (no additional checks on child fields)

if type is array, arrayType is required

if type is schema, schema property is required

#### require

set if field is required, default is false

#### min / max

string type: min / max length of String

integer, number: min / max value

array: min / max number of entries

#### valueMin / valueMax

only on array types, min / max property for single array entries

#### default

sets an default to the value if not set. Can't be set with require: true.

#### regEx

only on string: test against regEx

Example:

    ^[a-zA-Z]+$

Check if complete string is at least 1 character an only characters from a-z, A-Z

Beware most of the time you want to check with ^ for line start and $ for line end

If you only use an expression like

    [a-zA-Z]+

it will succeed, if at least one character is matching the regEx.

So a string "test1" will fail with the first expression, but succeed with the second expression.

#### valueRegEx

only on array of string, regEx property for single array entries

#### arrayType

only on array type, type for single array entries

#### schema

only on schema type, name of the sub schema or an comma seperated list of schemas

#### includeSchema

includes one or more schemas to the actual schema

## Conditonal schemas

It is possible to define conditions on schema or includeSchema.

Possible Operators: =, !=, <, >, and

The conditions are checked against the data on the schema level. Default values are only taken if the schema is already included.

Syntax: schemaName on {field}{operator}{value}[ and {field}{operator}{value}][, {field}{operator}{value}[ and {field}{operator}{value}]]

You can add any number of comma or and separated conditions.

Most or operations are possible with just a new comma seperated command

Examples:

    - chatMessageText on errorCode=0 and msgtype>0, chatMessageHtml on errorCode=0 and msgtype=2 and addedHtml=1

    - errorMsg, result on errorCode=0

    - errorMsg, result on errorCode=0, result on errorCode=2 and response=1




