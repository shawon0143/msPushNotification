
import * as jsonSocket from "../index";

console.log('start');

let jsonSocketClients = new jsonSocket.clients({ logLevel: 3, useTls: false }, (json: any, connection: jsonSocket.ConnectionData) => {
    console.log('unknown command client');
    connection.sendResponse(json.requestId, 1, {err:'unknown'});
});

let jsonSocketServer = new jsonSocket.server({ logLevel: 3 }, (json: any, connection: jsonSocket.ConnectionData) => {
    console.log('unknown command server');
    connection.sendResponse(json.requestId, 1, {err:'unknown'});
});

jsonSocketServer.createServer('127.0.0.1', 10001);

let client = jsonSocketClients.connect('127.0.0.1', 10001, (connected: boolean, _connectionData: jsonSocket.ConnectionData) => {
    console.log('connected: ' + connected);
});

setTimeout(() => {
    client.sendRequest("test", {}, (json, _connectionData) => {
        console.log('response:');
        console.log(json);
    });
}, 1000);

